<?xml version='1.0' encoding='utf-8'?>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<h2>The Injector</h2>

<p>
A running process is created by combining many different libraries (and other components).
In the Zero Install world, we have all versions of each library available at
all times. The problem then is how to choose which versions to use.
</p>

<p>
The injector solves this problem by selecting components to meet a program's requirements,
according to rules specified by the user:
</p>

<p style='text-align: center'>
<img width="569" height="364" src="inject.png"
     alt="The injector selects versions according to the user's policy" />
</p>

<h2>Trying it out</h2>

<p>
A prototype of the injector is now available. To try it out, you will need:
</p>

<ul>
<li><a href="http://python.org">Python</a> (version 2.3 or later).</li>
<li><a href="http://www.gnupg.org/">GnuPG</a> (to check the digital signatures).</li>
<li><a href="http://0install.net/public_key.gpg">My GPG key</a>. You can download and import
it with:
<pre>
$ gpg --recv-key --keyserver www.keyserver.net 59A53CC1
</pre>
</li>
</ul>

<div class='note'>The current release (0.2) is just an experimental prototype. It will
contain a few bugs.</div>

<p>
To run the injector, use the <b>0launch</b> or <b>0launch-gui</b> commands. <b>0launch</b>
tries to run a program without prompting, while the GUI version asks you to confirm or
adjust the selected versions. The injector is available through Zero Install, but can also
be used without it.
</p>

<h3>Getting the injector using Zero Install</h3>
<p>
The injector is on the <b>zero-install.sourceforge.net</b> site. You can access it like this:
</p>
<pre>
$ <b>alias 0launch=/uri/0install/zero-install.sourceforge.net/bin/0launch</b>
$ <b>alias 0launch-gui=/uri/0install/zero-install.sourceforge.net/bin/0launch-gui</b>
</pre>

<h3>Running the GUI without Zero Install</h3>
<p>
If you're not using the Zero Install filesystem, you can
download the injector from <a
href="http://sourceforge.net/project/showfiles.php?group_id=76468&amp;package_id=146899">the
download page</a>. You don't need to download <b>0launch-gui</b> manually; you can use
0launch to get it!
</p>
<pre>
$ <b>wget http://heanet.dl.sourceforge.net/sourceforge/zero-install/injector-0.2.tgz.gpg</b>
$ <b>gpg injector-0.2.tgz.gpg</b>
$ <b>tar xzf injector-0.2.tgz</b>
$ <b>alias 0launch="`pwd`/injector-0.2/0launch-auto"</b>
$ <b>alias 0launch-gui="0launch http://0install.net/2005/interfaces/injector-gui"</b>
</pre>

<div class='note'>TODO: This really needs a 'make install'!</div>

<h3>Running Edit with the injector</h3>

<p>
Run the GUI command, giving it the URL for the program you want to run, as shown below.
You will be prompted to confirm that you trust my GPG key.
</p>

<pre>
$ <b>0launch-gui http://rox.sourceforge.net/2005/interfaces/Edit</b>
Currently downloading:
- http://0install.net/2005/interfaces/injector-gui

Interface: http://0install.net/2005/interfaces/injector-gui
The interface is correctly signed with the following keys:
- Valid signature from 92429807C9853C0744A68B9AAE07828059A53CC1
Do you want to trust all of these keys to sign interfaces?
Trust all [Y/N] <b>Y</b>
Trusting 92429807C9853C0744A68B9AAE07828059A53CC1
Currently downloading:
- http://0install.net/2005/interfaces/injector
</pre>

<p>
The <b>0launch-gui</b> command actually just invokes the non-graphical <b>0launch</b>
command, giving it the interface for the GUI
(<b>http://0install.net/2005/interfaces/injector-gui</b>). <b>0launch</b> downloaded this
interface and asked you to confirm that you trust software written by me. Then it downloaded
the archive from sourceforge and unpacked it into the cache directory (after checking that
its signature was correct).
</p>

<div class='note'>TODO: Archives are currently unpacked to your home directory, in
<b>~/.cache/0install.net/implementations/</b>. In future, they will unpack to
a shared directory under <b>/var/cache</b>, using a setuid helper (which will
check the cryptographic digest first, of course).</div>

<p>
<b>0launch-gui</b> is an interactive graphical interface to the injector, which pops up this
dialog box:
</p>

<p style='text-align: center'>
<img width="408" height="330" src="edit-injector.png"
     alt="Running Edit with the injector" />
</p>

<p>
The main part of the windows contains a list of all the components needed to run Edit.
At the top is Edit itself, and shown below is ROX-Lib, which Edit needs in order to function.
If you are happy with the selected versions, click on <b>Execute</b> to run the
program.
</p>

<p>
When you click on <b>Execute</b>, the injector will start downloading the two chosen
versions (this time showing the progress in a window, now the GUI is being used):
</p>

<p style='text-align: center'>
<img width="327" height="144" src="injector-downloading.png"
     alt="Downloading Edit and ROX-Lib" />
</p>

<p>
You can affect which versions are chosen by changing your policy. Three aspects
of your policy are shown in the main window: <b>Network use</b>, <b>Freshness</b>
and <b>Help test new versions</b>. Click on <b>Help test new versions</b>, and
you may see the version numbers increase, as the injector chooses newer, less
well tested, versions. Note however that you may not see any change at all,
since there may not be new testing versions available when you try it.
</p>

<p>
To get the injector to notice that a new version is available, click on the <b>Refresh all now</b>
button (which fetches a fresh copy of each listed interface). You can also set the freshness
policy; the injector will automatically check for updates to interfaces that haven't been
checked within the allowed time.
</p>

<p>
These are not the only policy settings. The rest are per-component, and are
accessed by double-clicking on a line in the list. This is described in the following sections.
</p>

<p>Note that all changes to your policy are saved as soon as you make them.
Clicking on <b>Cancel</b> will close the window without running the program,
but any changes made to the policy are not reversed.
</p>


<h2>Choosing different versions</h2>

<p>
The interface URI (<b>http://rox.sourceforge.net/2005/interfaces/Edit</b>) is
used to get the default list of implementations. You can see the information
about an interface by double-clicking on it in the list of interfaces. For
example, double-clicking on <b>Edit</b> displays this dialog box:
</p>

<p style='text-align: center'>
  <img width="627" height="345" src="edit-properties.png"
  	alt="Properties of the Edit interface" />
</p>

<p>
The information displayed is fetched from the interface file, which you can view in
a web browser if you're interested:
<a href="http://rox.sourceforge.net/2005/interfaces/Edit">Edit's interface</a>. This is
a plain-text GPG-signed file. The injector stores the downloaded interface files
locally (in <b>~/.config/0install.net/injector/interfaces</b>).
</p>

<div class='note'>TODO: Store upstream interfaces in <b>~/.cache</b>, not <b>~/.config</b>.</div>

<h2>Stability</h2>

<p>
The interface file also gives a stability rating for each implementation. The following
levels are allowed:
</p>

<ul>
<li>Stable</li>
<li>Testing</li>
<li>Developer</li>
<li>Buggy</li>
<li>Insecure</li>
</ul>

<p>
Stability ratings are kept independently of the implementations, and are expected to change over
time. When any new release is made, its stability is initially set to <b>Testing</b>. If you
have selected <b>Help test new versions</b> then you will then start using it.
Otherwise, you will continue with the previous stable release. After a while
(days, weeks or months, depending on the project) with no serious problems
found, the author will change the implementation's stability to <b>Stable</b> so that
everyone will use it.
</p>

<p>
If problems are found, it will instead be marked as <b>Buggy</b>, or <b>Insecure</b>. The injector
won't select either by default, but it is useful to see the reason (you might opt to
continue using a buggy version if it works for you, but should never use an insecure
one). <b>Developer</b> is like a more extreme version of <b>Testing</b>, where the program is
expected to have bugs.
</p>

<p>
You can use the <b>Preferred Stability</b> setting in the interface dialog to choose which
versions to use. You can also change the stability rating of any implementation by clicking on it
and choosing a new rating from the popup menu. User-set ratings are shown in capitals.
</p>

<p>
As you make changes to the policy and ratings, the order of the implementations in the list
will change. The version at the top is the one that the injector will actually use. In addition
to the ratings above, you can set the rating to <b>Preferred</b>. Such versions always come first,
unless they're not cached and you are in Off-line mode.
</p>

<p>
Note: If you want to use the second item on the list because the first is
buggy, for example, then it is better to mark the first version as buggy than to mark the
second as preferred. This is because when a new version is available, you will want that to
become the version at the top of the list, whereas a preferred version will always be first.
</p>

<h2>Further reading</h2>

<ul>
<li><a href="injector-packagers.html">The Injector: Packaging Guide</a> is for people who
want to make software available to others through the injector.</li>
<li><a href="injector-design.html">The Injector: Design</a> explains the design of the injector
itself.</li>
</ul>
 
</html>
